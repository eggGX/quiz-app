<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>クイズソロバトル</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div class="brand">
          <span class="brand__icon" aria-hidden="true">✦</span>
          <div class="brand__text">
            <h1 class="brand__title">クイズソロバトル</h1>
            <p class="brand__subtitle">ひとりで挑んで、みんなで競うランキング</p>
          </div>
          <span id="countdown" aria-label="残り時間">20s</span>
        </div>
        <nav class="header-actions" aria-label="アプリ操作">
          <button id="viewRankingButton" type="button" class="ghost-button">
            ランキングを見る
          </button>
          <button id="switchThemeButton" type="button" class="ghost-button" aria-label="テーマ切替">
            🌙
          </button>
        </nav>
      </header>

      <main class="app-main">
        <section id="startView" class="view view--active" aria-labelledby="startHeading">
          <div class="view__body">
            <div class="card card--padded">
              <h2 id="startHeading" class="card__title">準備しましょう</h2>
              <p class="card__description">
                名前を入力して出題数を選ぶだけ。セッションコードを共有すれば、別端末のスコアもひとつのランキングにまとまります。
              </p>

              <form id="setupForm" class="form-grid" novalidate>
                <label class="form-field">
                  <span class="form-field__label">名前</span>
                  <input id="playerName" name="playerName" type="text" inputmode="text" autocomplete="name" required maxlength="16" placeholder="例: さくら" />
                  <span class="form-field__hint">端末ごとに自由に決めてOKです。</span>
                </label>

                <label class="form-field">
                  <span class="form-field__label">出題数</span>
                  <select id="questionCount" name="questionCount">
                    <option value="5">5問</option>
                    <option value="10" selected>10問</option>
                    <option value="15">15問</option>
                    <option value="20">20問</option>
                  </select>
                </label>

                <fieldset class="form-field">
                  <legend class="form-field__label">セッションコード</legend>
                  <div class="session-field">
                    <input id="sessionCode" name="sessionCode" type="text" inputmode="latin" maxlength="12" placeholder="例: SAKURA12" aria-describedby="sessionHint" />
                    <button id="generateSessionButton" class="ghost-button" type="button">新しく作成</button>
                  </div>
                  <p id="sessionHint" class="form-field__hint">
                    みんなで同じコードを使うとランキングが共有されます。空欄なら自動生成します。
                  </p>
                </fieldset>

                <div class="form-actions">
                  <button class="primary-button" type="submit">クイズを始める</button>
                </div>
              </form>
            </div>

            <aside class="card card--side" aria-label="ランキング">
              <header class="card__header">
                <h3 class="card__title">現在のランキング</h3>
                <span id="activeSessionLabel" class="badge"></span>
              </header>
              <ol id="startRankingList" class="ranking-list"></ol>
              <footer class="card__footer">
                <button id="copyStartShareButton" class="ghost-button" type="button">共有リンクをコピー</button>
                <p class="card__note">同じリンクでアクセスすれば別端末でも同じランキングが表示されます。</p>
              </footer>
            </aside>
          </div>
        </section>

        <section id="quizView" class="view" aria-live="polite" aria-labelledby="quizHeading">
          <div class="quiz-layout">
            <div class="card card--padded quiz-card">
              <header class="quiz-card__header">
                <h2 id="quizHeading" class="card__title">
                  <span id="questionBadge" class="badge"></span>
                  <span id="questionTitle">問題を読んでください</span>
                </h2>
                <div class="progress">
                  <div id="progressBar" class="progress__bar"></div>
                </div>
              </header>

              <p id="questionText" class="quiz-question"></p>
              <ul id="choicesList" class="choice-list"></ul>

              <div class="quiz-status">
                <span id="correctCounter">正解: 0</span>
                <span id="timerDisplay">00:00</span>
              </div>
            </div>

            <aside class="card card--side quiz-info" aria-live="polite">
              <h3 class="card__title">スコア</h3>
              <div class="score-highlight">
                <span id="scoreValue">0</span>
                <span class="score-label">pts</span>
              </div>
              <p id="remainingCount" class="card__note"></p>
              <button id="skipQuestionButton" class="ghost-button" type="button">次の問題へ</button>
            </aside>
          </div>
        </section>

        <section id="resultView" class="view" aria-labelledby="resultHeading">
          <div class="card card--padded result-summary">
            <header class="card__header">
              <h2 id="resultHeading" class="card__title">結果発表</h2>
              <p id="resultCaption" class="card__description"></p>
            </header>
            <div class="result-stats">
              <div>
                <p class="result-stat__label">スコア</p>
                <p id="finalScore" class="result-stat__value">0</p>
              </div>
              <div>
                <p class="result-stat__label">正解数</p>
                <p id="finalCorrect" class="result-stat__value">0</p>
              </div>
              <div>
                <p class="result-stat__label">タイム</p>
                <p id="finalTime" class="result-stat__value">00:00</p>
              </div>
            </div>
            <div class="result-actions">
              <button id="playAgainButton" class="primary-button" type="button">同じセッションでもう一度</button>
              <button id="returnStartButton" class="ghost-button" type="button">スタートに戻る</button>
            </div>
          </div>

          <div class="card card--padded result-ranking">
            <header class="card__header">
              <h3 class="card__title">セッションランキング</h3>
              <span id="resultSessionLabel" class="badge"></span>
            </header>
            <div class="table-wrapper">
              <table class="ranking-table">
                <thead>
                  <tr>
                    <th scope="col">順位</th>
                    <th scope="col">名前</th>
                    <th scope="col">スコア</th>
                    <th scope="col">正解数</th>
                    <th scope="col">タイム</th>
                    <th scope="col">プレイ日時</th>
                  </tr>
                </thead>
                <tbody id="resultRankingBody"></tbody>
              </table>
            </div>
            <footer class="card__footer">
              <div class="share-tools">
                <button id="copyResultShareButton" class="primary-button" type="button">ランキングリンクをコピー</button>
                <button id="downloadResultButton" class="ghost-button" type="button">CSVで保存</button>
              </div>
              <p class="card__note">
                共有リンクを別端末で開いてプレイすると、同じランキングに結果が追加されます。
              </p>
            </footer>
          </div>
        </section>
      </main>

      <footer class="app-footer">
        <small>みんなの挑戦を記録して、最高のスコアを目指しましょう！</small>
      </footer>
    </div>
  </template>

    <dialog id="rankingDialog" class="ranking-dialog">
      <form method="dialog" class="ranking-dialog__card">
        <header>
          <h2>セッションランキング</h2>
        </header>
        <div class="ranking-dialog__content">
          <p id="dialogSessionLabel" class="badge"></p>
          <ol id="dialogRankingList" class="ranking-list"></ol>
        </div>
        <menu class="ranking-dialog__actions">
          <button value="close" class="primary-button">閉じる</button>
        </menu>
      </form>
    </dialog>

    <template id="rankingItemTemplate">
      <li class="ranking-list__item">
        <span class="ranking-list__rank"></span>
        <div class="ranking-list__main">
          <span class="ranking-list__name"></span>
          <span class="ranking-list__meta"></span>
        </div>
        <span class="ranking-list__score"></span>
      </li>
    </template>

    <template id="rankingRowTemplate">
      <tr>
        <th scope="row"></th>
        <td class="table__name"></td>
        <td class="table__score"></td>
        <td class="table__correct"></td>
        <td class="table__time"></td>
        <td class="table__played"></td>
      </tr>
    </template>

    <script type="module" src="app.js"></script>
  </body>
</html>
